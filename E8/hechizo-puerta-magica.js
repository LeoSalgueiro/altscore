/*

El Hechizo de la Puerta M치gica 游뛁
Contexto:

En la vasta biblioteca de Altwarts, los antiguos fundadores escondieron un conocimiento arcano, protegido por un hechizo poderoso conocido como "El Encantamiento de la Puerta M치gica".
 Para desentra침ar este conocimiento, debes resolver el acertijo que dejaron atr치s.
  Cada pista te llevar치 m치s cerca de la soluci칩n final, pero ten cuidado, pues solo los magos m치s astutos ser치n capaces de encontrar el camino.

Primera pista: El Reloj de los Segundos

En la Torre del Reloj de Altwarts, el tiempo es tu mayor aliado y tu peor enemigo. Cada segundo marca el paso de una clave que abre una puerta.
 Elige el momento correcto, y la llave ser치 tuya. Pero recuerda, solo en el primer segundo puedes encontrar la llave de la primera puerta.

Segunda pista: Acci칩n y reacci칩n, las puertas traen revelaci칩n

En el aula de Encantamientos, el profesor Flitwick guarda un pergamino antiguo que habla de palabras ocultas, no en los hechizos mismos, sino en las consecuencias de su lanzamiento.
 Cada acci칩n m치gica genera una reacci칩n, y en esa reacci칩n yacen los secretos que buscan los magos astutos. Solo aquellos que observan m치s all치 de lo evidente, que desentra침an 
 los hilos invisibles que conectan causa y efecto, podr치n descifrar el verdadero mensaje.

Tercera pista:

En el Gran Comedor, N puertas m치gicas est치n alineadas, cada una desbloqueada solo por una palabra.
 Un hechizo pronunciado mal te perder치, pero el correcto te guiar치. Solo avanzando en orden y en el momento adecuado, alcanzar치s tu objetivo.

Cuarta pista:

Cada puerta te llevar치 a la siguiente, pero la respuesta no se encuentra al final, sino que el camino mismo es la clave. Recuerda usar el hechizo Revelio para ver lo que est치 oculto.

*/


const axios = require('axios');



const puertaMagica = async () => {
    const headers = {
        'Content-Type': 'application/json',
        'API-KEY': '895aabdb40874bf6becc33284972ba71'
    }   
    
    const puerta = await axios.post(`${process.env.URL_BASE}v1/s1/e8/actions/door`, 
        {"Hechizo": "Revelio"} 
    , {headers: headers}).then(response => {
        const now = new Date();
        const timestamp = `${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;
        return {
            ...response.data,
            timestamp
        };
    }).catch(error => {
        return error;
    });
 

    return puerta;
}

const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));

const e8 = async () => {
    const respuestas = [];
    const contador = 50;

    for (let i = 0; i < contador; i++) {
        console.log(`Consultando puerta m치gica ${i + 1} de ${contador}`);
        const response = await puertaMagica();
        respuestas.push(response);
        await delay(1000); 
    }

    // Convertir el array de respuestas en un objeto
    const respuestasObjeto = respuestas.reduce((obj, respuesta, index) => {
        if(respuesta.status !== 403 ){
            obj[index] = respuesta;
        }
        return obj;
    }, {});

    return respuestasObjeto;
}

module.exports = { e8 };

